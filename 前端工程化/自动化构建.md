# æ¦‚è¿°

**è‡ªåŠ¨åŒ–æ„å»º**å°±æ˜¯æŒ‡å°†å¼€å‘ä»£ç è‡ªåŠ¨è½¬åŒ–æˆä¸ºç”Ÿäº§ç¯å¢ƒå¯ä»¥è¿è¡Œçš„ä»£ç æˆ–ç¨‹åºã€‚ä¸€èˆ¬æˆ‘ä»¬å°†è¿™æ ·çš„è¿‡ç¨‹ç§°ä¸ºâ€œ**è‡ªåŠ¨åŒ–æ„å»ºå·¥ä½œæµ**â€ã€‚

**ä½œç”¨**ï¼šè®©å¼€å‘äººå‘˜å°½å¯èƒ½è„±ç¦»è¿è¡Œç¯å¢ƒå…¼å®¹æ‰€å¸¦æ¥çš„çš„é—®é¢˜ï¼Œåœ¨å¼€å‘é˜¶æ®µä½¿ç”¨æé«˜æ•ˆç‡çš„è¯­æ³•ã€è§„èŒƒå’Œæ ‡å‡†ã€‚é€šè¿‡è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œå¯ä»¥æ„å»ºè½¬æ¢æµè§ˆå™¨ä¸è¢«æ”¯æŒçš„ç‰¹æ€§ï¼Œæ¯”å¦‚ESæœ€æ–°æ ‡å‡†ã€SCSS ç­‰



# è‡ªåŠ¨åŒ–ä½“éªŒ

> è¯´æ˜ï¼šå…ˆé€šè¿‡CSSè¿›è¡Œæ ·å¼çš„ä¹¦å†™ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿé€šè¿‡ SCSS è¿›è¡Œå¯¹ CSS å¢å¼ºã€‚é€šè¿‡åœ¨å¼€å‘æ—¶æ·»åŠ ä¸€ä¸ªæ„å»ºçš„ç¯èŠ‚ï¼Œå°† SCSS æ„å»ºä¸º CSS å³å¯ã€‚

**1. å»ºç«‹ä¸ªäººæµ‹è¯•é¡¹ç›®**

```tex
|-scss
	|- main.scss
|-index.html
|-package.json
```

**2. è½¬æ¢å¼€å‘é˜¶æ®µSCSS**

> æµè§ˆå™¨ä¸æ”¯æŒ SCSS è¯­æ³•ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡å·¥å…·å°†å…¶è¿›è¡Œè½¬åŒ–

```bash
# å®‰è£…ç›¸åº”ä¾èµ–
yarn add sass --dev
# è¿è¡Œå·¥å…·æŒ‡ä»¤
.\node_modules\.bin\sass scss/main.scss css/style.css
```

ä»¥ä¸Šå‘½ä»¤å¤ªè¿‡å¤æ‚ï¼Œé€šè¿‡ NPM Scripts å°†å…¶ä¼˜åŒ–ä¸€ä¸‹ï¼š

> scripts å¯ä»¥è‡ªåŠ¨å‘ç° node_modules é‡Œé¢çš„å‘½ä»¤

```json
// ä¿®æ”¹ package.json
{
  "scripts": {
    "build": "sass scss/main.scss css/style.css",
    "serve": "browser-sync .",
  },
}
```

```bash
# browser-sync ç”¨æ¥å¯åŠ¨æµ‹è¯•æœåŠ¡å™¨
yarn add browser-sync --dev
```

ä»¥ä¸Šï¼Œè¿è¡Œ `yarn serve` å‘½ä»¤åï¼Œå°±ä¼šè‡ªåŠ¨å¯åŠ¨ä¸€ä¸ªwebæœåŠ¡å™¨å¹¶ä¸”å”¤èµ·æµè§ˆå™¨

**3. ä¼˜åŒ–ç›¸åº”æŒ‡ä»¤**

**3.1 åœ¨é¡µé¢å¯åŠ¨ä¹‹å‰ç”ŸæˆCSSæ–‡ä»¶**

ä½¿ç”¨  NPM Scripts çš„é’©å­æœºåˆ¶ï¼Œæ·»åŠ  `preserve` å‘½ä»¤ã€‚ `preserve` ä¼šåœ¨ serve æ‰§è¡Œä¹‹å‰è¿›è¡Œæ‰§è¡Œã€‚

```json
{
  "scripts": {
    "build": "sass scss/main.scss css/style.css",
    "preserve": "yarn build",
    "serve": "browser-sync .",
  },
}
```

è¿è¡Œ `yarn serve` å‘½ä»¤åï¼Œå°±èƒ½å¾—åˆ°æƒ³è¦çš„æ•ˆæœäº†

**3.2 SCSSæ–‡ä»¶ä¿®æ”¹åè‡ªåŠ¨ç¼–è¯‘ä»£ç **

```bash
# å®‰è£…æ‰€éœ€ä¾èµ–
yarn add npm-run-all --dev
```

```json
// æ·»åŠ  start å‘½ä»¤ï¼šåŒæ—¶æ‰§è¡Œå¤šä¸ªå‘½ä»¤
// --files å¯ä»¥è®©æµè§ˆå™¨å¯åŠ¨åç›‘å¬æ–‡ä»¶çš„ç›¸åº”å˜åŒ–åšå‡ºå“åº”
{
  "scripts": {
    "build": "sass scss/main.scss css/style.css --watch",
    "serve": "browser-sync . --files \"css/*.css\"",
    "start": "run-p build serve"
  },
}
```



# å¸¸ç”¨çš„è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·

- Grunt
  æ’ä»¶ç”Ÿæ€å®Œå–„
  æ„å»ºé€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ï¼ŒåŸºäºä¸´æ—¶æ–‡ä»¶è¿›è¡Œç£ç›˜è¯»å†™æ“ä½œ
- Gulp
  ç›¸å¯¹Gruntæ„å»ºé€Ÿåº¦è¾ƒå¿«ï¼ŒåŸºäºå†…å­˜è¿›è¡Œæ“ä½œ
  æ”¯æŒåŒæ—¶æ‰§è¡Œå¤šä»»åŠ¡
- FIS
  å¤§è€Œå…¨

## Grunt

### åŸºæœ¬ä½¿ç”¨

```bash
# åˆå§‹åŒ– package.json
yarn init --y
# å®‰è£…ç›¸åº”ä¾èµ–
yarn add grunt
# åˆ›å»ºgruntå…¥å£æ–‡ä»¶
code gruntfile.js
# ä¹¦å†™ gruntfile.js
# è¿è¡Œç›¸åº”å‘½ä»¤ yarn grunt <task name>
yarn grunt foo
```

```js
// gruntfile.js
// Grunt çš„å…¥å£æ–‡ä»¶
// ç”¨äºå®šä¹‰ä¸€äº›éœ€è¦ Grunt è‡ªåŠ¨æ‰§è¡Œçš„ä»»åŠ¡
// éœ€è¦å¯¼å‡ºä¸€ä¸ªå‡½æ•°
// æ­¤å‡½æ•°æ¥æ”¶ä¸€ä¸ª grunt çš„å¯¹è±¡ç±»å‹çš„å½¢å‚
// grunt å¯¹è±¡ä¸­æä¾›ä¸€äº›åˆ›å»ºä»»åŠ¡æ—¶ä¼šç”¨åˆ°çš„ API

module.exports = (grunt) => {
  /**
   * æ³¨å†Œä»»åŠ¡
   * ä»»åŠ¡çš„åå­—
   * ä»»åŠ¡çš„æè¿° | ä»»åŠ¡çš„å‡½æ•° é€šè¿‡ yarn grunt --help åœ¨ Available tasks ä¸­å¯ä»¥çœ‹åˆ°
   */
  grunt.registerTask("foo", "a sample task", () => {
    console.log("hello grunt");
  });

  grunt.registerTask("bar", () => {
    console.log("other task");
  });

  // // default æ˜¯é»˜è®¤ä»»åŠ¡åç§°
  // // é€šè¿‡ grunt æ‰§è¡Œæ—¶å¯ä»¥çœç•¥
  // grunt.registerTask('default', () => {
  //   console.log('default task')
  // })

  // ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æŒ‡å®šæ­¤ä»»åŠ¡çš„æ˜ å°„ä»»åŠ¡ï¼Œ
  // è¿™æ ·æ‰§è¡Œ default å°±ç›¸å½“äºæ‰§è¡Œå¯¹åº”çš„ä»»åŠ¡
  // è¿™é‡Œæ˜ å°„çš„ä»»åŠ¡ä¼šæŒ‰é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œä¸ä¼šåŒæ­¥æ‰§è¡Œ
  grunt.registerTask("default", ["foo", "bar"]);

  // ä¹Ÿå¯ä»¥åœ¨ä»»åŠ¡å‡½æ•°ä¸­æ‰§è¡Œå…¶ä»–ä»»åŠ¡
  grunt.registerTask("run-other", () => {
    // foo å’Œ bar ä¼šåœ¨å½“å‰ä»»åŠ¡æ‰§è¡Œå®Œæˆè¿‡åè‡ªåŠ¨ä¾æ¬¡æ‰§è¡Œ
    grunt.task.run("foo", "bar");
    console.log("current task runing~");
  });

  // é»˜è®¤ grunt é‡‡ç”¨åŒæ­¥æ¨¡å¼ç¼–ç 
  // å¦‚æœéœ€è¦å¼‚æ­¥å¯ä»¥ä½¿ç”¨ this.async() æ–¹æ³•åˆ›å»ºå›è°ƒå‡½æ•°
  // grunt.registerTask('async-task', () => {
  //   setTimeout(() => {
  //     console.log('async task working~')
  //   }, 1000)
  // })

  // ç”±äºå‡½æ•°ä½“ä¸­éœ€è¦ä½¿ç”¨ thisï¼Œæ‰€ä»¥è¿™é‡Œä¸èƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°
  grunt.registerTask("async-task", function () {
    const done = this.async();
    setTimeout(() => {
      console.log("async task working~");
      done();
    }, 1000);
  });
};
```

### æ ‡è®°ä»»åŠ¡å¤±è´¥

- å¯ä»¥åœ¨å‡½æ•°ä½“ä¸­`return false` è¿›è¡Œå®ç°
- å¦‚æœå½“å‰ä»»åŠ¡æ˜¯åœ¨ä»»åŠ¡åˆ—è¡¨ä¸­çš„è¯ï¼Œä¼šå¯¼è‡´åç»­ä»»åŠ¡ä¸å†ç»§ç»­æ‰§è¡Œ
- å¼‚æ­¥å‡½æ•°ä¸­æ ‡è®°å½“å‰ä»»åŠ¡æ‰§è¡Œå¤±è´¥çš„æ–¹å¼: ä¸ºå›è°ƒå‡½æ•°æŒ‡å®šä¸€ä¸ª false çš„å®å‚

```js
// gruntfile.js
module.exports = grunt => {
  // ä»»åŠ¡å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœè¿”å› false
  // åˆ™æ„å‘³ç€æ­¤ä»»åŠ¡æ‰§è¡Œå¤±è´¥
  grunt.registerTask('bad', () => {
    console.log('bad working~')
    return false
  })

  grunt.registerTask('foo', () => {
    console.log('foo working~')
  })

  grunt.registerTask('bar', () => {
    console.log('bar working~')
  })

  // å¦‚æœä¸€ä¸ªä»»åŠ¡åˆ—è¡¨ä¸­çš„æŸä¸ªä»»åŠ¡æ‰§è¡Œå¤±è´¥
  // åˆ™åç»­ä»»åŠ¡é»˜è®¤ä¸ä¼šè¿è¡Œ
  // é™¤é grunt è¿è¡Œæ—¶æŒ‡å®š --force å‚æ•°å¼ºåˆ¶æ‰§è¡Œ
  grunt.registerTask('default', ['foo', 'bad', 'bar'])

  // å¼‚æ­¥å‡½æ•°ä¸­æ ‡è®°å½“å‰ä»»åŠ¡æ‰§è¡Œå¤±è´¥çš„æ–¹å¼æ˜¯ä¸ºå›è°ƒå‡½æ•°æŒ‡å®šä¸€ä¸ª false çš„å®å‚
  grunt.registerTask('bad-async', function () {
    const done = this.async()
    setTimeout(() => {
      console.log('async task working~')
      done(false)
    }, 1000)
  })
}
```

### é…ç½®é€‰é¡¹æ–¹æ³•

> grunt.initConfig()

```js
// gruntfile.js
module.exports = grunt => {
  // grunt.initConfig() ç”¨äºä¸ºä»»åŠ¡æ·»åŠ ä¸€äº›é…ç½®é€‰é¡¹
  grunt.initConfig({
    // é”®ä¸€èˆ¬å¯¹åº”ä»»åŠ¡çš„åç§°
    // å€¼å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„æ•°æ®
    foo: {
      bar: 'baz'
    }
  })

  grunt.registerTask('foo', () => {
    // ä»»åŠ¡ä¸­å¯ä»¥ä½¿ç”¨ grunt.config() è·å–é…ç½®
    console.log(grunt.config('foo'))
    // å¦‚æœå±æ€§å€¼æ˜¯å¯¹è±¡çš„è¯ï¼Œconfig ä¸­å¯ä»¥ä½¿ç”¨ç‚¹çš„æ–¹å¼å®šä½å¯¹è±¡ä¸­å±æ€§çš„å€¼
    console.log(grunt.config('foo.bar'))
  })
}
```

### å¤šç›®æ ‡ä»»åŠ¡

å¦‚æœæƒ³è¦è¿è¡ŒæŒ‡å®šçš„ç›®æ ‡ï¼Œå¦‚ä¸‹ç¤ºä¾‹å¯ä»¥ä½¿ç”¨ `yarn grunt build:foo`
åœ¨ build ä¸­æŒ‡å®šçš„æ¯ä¸€ä¸ªé”®éƒ½ä¼šæˆä¸ºä¸€ä¸ªç›®æ ‡ï¼Œé™¤äº†optionsã€‚åœ¨ options ä¸­æŒ‡å®šçš„ä¿¡æ¯ä¼šä½œä¸ºä»»åŠ¡çš„é…ç½®é€‰é¡¹å‡ºç°
å­ç›®æ ‡ä»»åŠ¡çš„é…ç½®é€‰é¡¹ä¼šè¦†ç›–ç›®æ ‡ä»»åŠ¡çš„é…ç½®é€‰é¡¹

```js
// gruntfile.js
module.exports = grunt => {
  // å¤šç›®æ ‡æ¨¡å¼ï¼Œå¯ä»¥è®©ä»»åŠ¡æ ¹æ®é…ç½®å½¢æˆå¤šä¸ªå­ä»»åŠ¡

  // grunt.initConfig({
  //   build: {
  //     foo: 100,
  //     bar: '456'
  //   }
  // })

  // grunt.registerMultiTask('build', function () {
  //   console.log(`task: build, target: ${this.target}, data: ${this.data}`)
  // })

  grunt.initConfig({
    build: {
      options: {
        msg: 'task options'
      },
      foo: {
        options: {
          msg: 'foo target options'
        }
      },
      bar: '456'
    }
  })

  grunt.registerMultiTask('build', function () {
    console.log(this.options()) // å¯ä»¥è·å–åˆ°ç›¸åº”çš„é…ç½®é€‰é¡¹
  })
}
```

### æ’ä»¶

æ’ä»¶æœºåˆ¶æ˜¯ Grunt çš„æ ¸å¿ƒã€‚æ’ä»¶å†…éƒ¨å°è£…äº†å¾ˆå¤šé€šç”¨çš„æ„å»ºä»»åŠ¡ï¼Œä¸€èˆ¬æˆ‘ä»¬çš„æ„å»ºè¿‡ç¨‹éƒ½æ˜¯ç”±è¿™äº›é€šç”¨çš„æ„å»ºä»»åŠ¡ç»„æˆçš„ã€‚

**æ’ä»¶çš„ä½¿ç”¨æ­¥éª¤ï¼š**

1. é€šè¿‡ npm å®‰è£…ç›¸åº”æ’ä»¶
2. åœ¨ gruntfile ä¸­è½½å…¥æ’ä»¶æä¾›çš„ä»»åŠ¡
3. é€šè¿‡æ’ä»¶çš„æ–‡æ¡£é…ç½®å¥½éœ€è¦çš„é…ç½®é€‰é¡¹

**ğŸŒ° æ —å­**

```bash
# 1. å®‰è£…æ’ä»¶
yarn add grunt-contrib-clean
```

```js
// 2. è½½å…¥æ’ä»¶
module.exports = grunt => {
  // 3. é…ç½®é€‰é¡¹
  grunt.initConfig({
    clean: {
      temp: 'temp/**' // å¯ä»¥æŒ‡å®šæ–‡ä»¶ temp/read.txtã€æˆ–è€…é€šé…æŸç±»å‹æ–‡ä»¶ temp/*.txt
    }
  })
  
  grunt.loadNpmTasks('grunt-contrib-clean')
}
```

#### å¸¸ç”¨æ’ä»¶

##### grunt-sass

**å®‰è£…**

```bash
yarn add grunt-sass sass --dev
```

```js
const sass = require('sass')
const loadGruntTasks = require('load-grunt-tasks')

module.exports = grunt => {
  grunt.initConfig({
    sass: {
      options: {
        sourceMap: true,
        implementation: sass
      },
      main: {
        files: {
          // è¾“å‡ºçš„è·¯å¾„: åŸè·¯å¾„
          'dist/css/main.css': 'src/scss/main.scss'
        }
      }
    }
  })

  grunt.loadNpmTasks('grunt-sass')
}
```

##### grunt-babel

**å®‰è£…** `yarn add grunt-babel @babel/core @babel/preset-env --dev`

```bash
yarn add load-grunt-tasks --dev
```

```js
const sass = require('sass')
const loadGruntTasks = require('load-grunt-tasks')

module.exports = grunt => {
  grunt.initConfig({
    ...
    babel: {
      options: {
        sourceMap: true,
        presets: ['@babel/preset-env']
      },
      main: {
        files: {
          'dist/js/app.js': 'src/js/app.js'
        }
      }
    }
  })
  loadGruntTasks(grunt) // è‡ªåŠ¨åŠ è½½æ‰€æœ‰çš„ grunt æ’ä»¶ä¸­çš„ä»»åŠ¡
}
```

##### grunt-contrib-watch

```bash
yarn add grunt-contrib-watch --dev
```

```js
const sass = require('sass')
const loadGruntTasks = require('load-grunt-tasks')

module.exports = grunt => {
  grunt.initConfig({
    ...
    watch: {
      js: {
        files: ['src/js/*.js'],
        tasks: ['babel']
      },
      css: {
        files: ['src/scss/*.scss'],
        tasks: ['sass']
      }
    }
  })

  loadGruntTasks(grunt) // è‡ªåŠ¨åŠ è½½æ‰€æœ‰çš„ grunt æ’ä»¶ä¸­çš„ä»»åŠ¡

  grunt.registerTask('default', ['sass', 'babel', 'watch'])
}
```



## Gulp

### åŸºæœ¬ä½¿ç”¨

```bash
# åˆå§‹åŒ– package.json
yarn init --y
# å®‰è£…ç›¸åº”ä¾èµ–
yarn add gulp --dev
# åˆ›å»ºgulpå…¥å£æ–‡ä»¶
code gulpfile.js
# ä¹¦å†™ gulpfile.js
# è¿è¡Œç›¸åº”å‘½ä»¤ yarn gulp <task name>
yarn gulp foo
```

```js
// å¯¼å‡ºçš„å‡½æ•°éƒ½ä¼šä½œä¸º gulp ä»»åŠ¡
// gulp çš„ä»»åŠ¡å‡½æ•°éƒ½æ˜¯å¼‚æ­¥çš„
// å¯ä»¥é€šè¿‡è°ƒç”¨å›è°ƒå‡½æ•°æ ‡è¯†ä»»åŠ¡å®Œæˆ
exports.foo = done => {
  console.log('foo task working~')
  done() // æ ‡è¯†ä»»åŠ¡æ‰§è¡Œå®Œæˆ
}

// default æ˜¯é»˜è®¤ä»»åŠ¡
// åœ¨è¿è¡Œæ˜¯å¯ä»¥çœç•¥ä»»åŠ¡åå‚æ•°
exports.default = done => {
  console.log('default task working~')
  done()
}

// -----
// v4.0 ä¹‹å‰éœ€è¦é€šè¿‡ gulp.task() æ–¹æ³•æ³¨å†Œä»»åŠ¡
const gulp = require('gulp')

gulp.task('bar', done => {
  console.log('bar task working~')
  done()
})
```

### åˆ›å»ºç»„åˆä»»åŠ¡

```js
const { series, parallel } = require('gulp')

const task1 = done => {
  setTimeout(() => {
    console.log('task1 working~')
    done()
  }, 1000)
}

const task2 = done => {
  setTimeout(() => {
    console.log('task2 working~')
    done()
  }, 1000)  
}

const task3 = done => {
  setTimeout(() => {
    console.log('task3 working~')
    done()
  }, 1000)  
}

// è®©å¤šä¸ªä»»åŠ¡æŒ‰ç…§é¡ºåºä¾æ¬¡æ‰§è¡Œ
exports.foo = series(task1, task2, task3)

// è®©å¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œ
exports.bar = parallel(task1, task2, task3)
```

### å¼‚æ­¥ä»»åŠ¡

```js
const fs = require('fs')

exports.callback = done => {
  console.log('callback task')
  done()
}

exports.callback_error = done => {
  console.log('callback task')
  done(new Error('task failed'))
}

exports.promise = () => {
  console.log('promise task')
  return Promise.resolve()
}

exports.promise_error = () => {
  console.log('promise task')
  return Promise.reject(new Error('task failed'))
}

const timeout = time => {
  return new Promise(resolve => {
    setTimeout(resolve, time)
  })
}

exports.async = async () => {
  await timeout(1000)
  console.log('async task')
}

exports.stream = () => {
  const read = fs.createReadStream('yarn.lock')
  const write = fs.createWriteStream('a.txt')
  read.pipe(write)
  return read
}

// exports.stream = done => {
//   const read = fs.createReadStream('yarn.lock')
//   const write = fs.createWriteStream('a.txt')
//   read.pipe(write)
//   read.on('end', () => {
//     done()
//   })
// }
```

### æ„å»ºè¿‡ç¨‹æ ¸å¿ƒå·¥ä½œåŸç†

```js
const fs = require('fs')
const { Transform } = require('stream')

exports.default = () => {
  // æ–‡ä»¶è¯»å–æµ
  const readStream = fs.createReadStream('normalize.css')

  // æ–‡ä»¶å†™å…¥æµ
  const writeStream = fs.createWriteStream('normalize.min.css')

  // æ–‡ä»¶è½¬æ¢æµ
  const transformStream = new Transform({
    // æ ¸å¿ƒè½¬æ¢è¿‡ç¨‹
    transform: (chunk, encoding, callback) => {
      const input = chunk.toString()
      const output = input.replace(/\s+/g, '').replace(/\/\*.+?\*\//g, '')
      callback(null, output)
    }
  })

  return readStream
    .pipe(transformStream) // è½¬æ¢
    .pipe(writeStream) // å†™å…¥
}
```

![image-20220121155003851](./images/gulpæ„å»ºè¿‡ç¨‹æ ¸å¿ƒå·¥ä½œåŸç†.png)

### æ–‡ä»¶æ“ä½œAPI + æ’ä»¶çš„ä½¿ç”¨
