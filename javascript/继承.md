# JS å®ç°ç»§æ‰¿çš„å‡ ç§æ–¹å¼

## æ–¹å¼ä¸€ï¼š åŸå‹é“¾ç»§æ‰¿

> [å‚è€ƒå¤–é“¾]( https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Inheritance_and_the_prototype_chain)

```js
function Parent1() {
    this.name = 'parent1';
    this.play = [1, 2, 3]
}
function Child1() {
    this.type = 'child2';
}
Child1.prototype = new Parent1();
console.log(new Child1());

var s1 = new Child1();
var s2 = new Child1();
s1.play.push(4);
console.log(s1.play, s2.play);
```

ğŸ“¢ **Attention:**

å› ä¸ºä¸¤ä¸ªå®ä¾‹ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªåŸå‹å¯¹è±¡ã€‚å®ƒä»¬çš„å†…å­˜ç©ºé—´æ˜¯å…±äº«çš„ï¼Œå½“ä¸€ä¸ªå‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªä¹Ÿéšä¹‹è¿›è¡Œäº†å˜åŒ–ï¼Œè¿™å°±æ˜¯ä½¿ç”¨åŸå‹é“¾ç»§æ‰¿æ–¹å¼çš„ä¸€ä¸ªç¼ºç‚¹ã€‚



**æ–¹å¼äºŒ**: æ„é€ å‡½æ•°ç»§æ‰¿ï¼ˆå€ŸåŠ© callï¼‰

```js
function Parent1(){
    this.name = 'parent1';
  }

Parent1.prototype.getName = function () {
    return this.name;
}

function Child1(){
    Parent1.call(this);
    this.type = 'child1'
}

let child = new Child1();
console.log(child);  // æ²¡é—®é¢˜
console.log(child.getName());  // ä¼šæŠ¥é”™
```

Attentionï¼š

å®ƒä½¿çˆ¶ç±»çš„å¼•ç”¨å±æ€§ä¸ä¼šè¢«å…±äº«ï¼Œä¼˜åŒ–äº†ç¬¬ä¸€ç§ç»§æ‰¿æ–¹å¼çš„å¼Šç«¯ï¼›ä½†æ˜¯éšä¹‹è€Œæ¥çš„ç¼ºç‚¹ä¹Ÿæ¯”è¾ƒæ˜æ˜¾â€”â€”åªèƒ½ç»§æ‰¿çˆ¶ç±»çš„å®ä¾‹å±æ€§å’Œæ–¹æ³•ï¼Œä¸èƒ½ç»§æ‰¿åŸå‹å±æ€§æˆ–è€…æ–¹æ³•ã€‚



**æ–¹å¼ä¸‰**ï¼š ç»„åˆç»§æ‰¿ï¼ˆå‰ä¸¤ç§ç»„åˆï¼‰

```js
function Parent3 () {
    this.name = 'parent3';
    this.play = [1, 2, 3];
}

Parent3.prototype.getName = function () {
    return this.name;
}
function Child3() {
    // ç¬¬äºŒæ¬¡è°ƒç”¨ Parent3()
    Parent3.call(this);
    this.type = 'child3';
}

// ç¬¬ä¸€æ¬¡è°ƒç”¨ Parent3()
Child3.prototype = new Parent3();
// æ‰‹åŠ¨æŒ‚ä¸Šæ„é€ å™¨ï¼ŒæŒ‡å‘è‡ªå·±çš„æ„é€ å‡½æ•°
Child3.prototype.constructor = Child3;
var s3 = new Child3();
var s4 = new Child3();
s3.play.push(4);
console.log(s3.play, s4.play);  // ä¸äº’ç›¸å½±å“
console.log(s3.getName()); // æ­£å¸¸è¾“å‡º'parent3'
console.log(s4.getName()); // æ­£å¸¸è¾“å‡º'parent3'
```

Attention:

é€šè¿‡æ³¨é‡Šæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Parent3 æ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡æ˜¯æ”¹å˜Child3 çš„ prototype çš„æ—¶å€™ï¼Œç¬¬äºŒæ¬¡æ˜¯é€šè¿‡ call æ–¹æ³•è°ƒç”¨ Parent3 çš„æ—¶å€™ï¼Œé‚£ä¹ˆ Parent3 å¤šæ„é€ ä¸€æ¬¡å°±å¤šè¿›è¡Œäº†ä¸€æ¬¡æ€§èƒ½å¼€é”€ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸æ„¿çœ‹åˆ°çš„ã€‚



**æ–¹å¼å››**ï¼šåŸå‹å¼ç»§æ‰¿ã€ES5ï¼š Object.create ã€‘

```js
let parent4 = {
     name: "parent4",
     friends: ["p1", "p2", "p3"],
     getName: function() {
    	 return this.name;
     }
 };

let person4 = Object.create(parent4);
person4.name = "tom";
person4.friends.push("jerry");

let person5 = Object.create(parent4);
person5.friends.push("lucy");

console.log(person4.name);
console.log(person4.name === person4.getName());
console.log(person5.name);
console.log(person4.friends);
console.log(person5.friends);
```

Attentionï¼š

ç¼ºç‚¹ï¼šå¤šä¸ªå®ä¾‹çš„å¼•ç”¨ç±»å‹å±æ€§æŒ‡å‘ç›¸åŒçš„å†…å­˜ï¼Œå­˜åœ¨ç¯¡æ”¹çš„å¯èƒ½



**æ–¹å¼äº”**ï¼š å¯„ç”Ÿå¼ç»§æ‰¿

> ä½¿ç”¨åŸå‹å¼ç»§æ‰¿å¯ä»¥è·å¾—ä¸€ä»½ç›®æ ‡å¯¹è±¡çš„æµ…æ‹·è´ï¼Œç„¶ååˆ©ç”¨è¿™ä¸ªæµ…æ‹·è´çš„èƒ½åŠ›å†è¿›è¡Œå¢å¼ºï¼Œæ·»åŠ ä¸€äº›æ–¹æ³•ï¼Œè¿™æ ·çš„ç»§æ‰¿æ–¹å¼å°±å«ä½œå¯„ç”Ÿå¼ç»§æ‰¿ã€‚

```js
let parent5 = {
    name: "parent5",
    friends: ["p1", "p2", "p3"],
    getName: function() {
        return this.name;
    }
};

function clone(original) {
    let clone = Object.create(original);
    clone.getFriends = function() {
        return this.friends;
    };
    return clone;
}

let person5 = clone(parent5);

console.log(person5.getName());
console.log(person5.getFriends());
```

Attetion:

ä»æœ€åçš„è¾“å‡ºç»“æœä¸­å¯ä»¥çœ‹åˆ°ï¼Œperson5 é€šè¿‡ clone çš„æ–¹æ³•ï¼Œå¢åŠ äº† getFriends çš„æ–¹æ³•ï¼Œä»è€Œä½¿ person5 è¿™ä¸ªæ™®é€šå¯¹è±¡åœ¨ç»§æ‰¿è¿‡ç¨‹ä¸­åˆå¢åŠ äº†ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™æ ·çš„ç»§æ‰¿æ–¹å¼å°±æ˜¯å¯„ç”Ÿå¼ç»§æ‰¿ã€‚

ä¼˜ç¼ºç‚¹åŒåŸå‹å¼ç»§æ‰¿



**æ–¹å¼å…­**ï¼š å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿

```js
function clone (parent, child) {
    // è¿™é‡Œæ”¹ç”¨ Object.create å°±å¯ä»¥å‡å°‘ç»„åˆç»§æ‰¿ä¸­å¤šè¿›è¡Œä¸€æ¬¡æ„é€ çš„è¿‡ç¨‹
    child.prototype = Object.create(parent.prototype);
    child.prototype.constructor = child;
}

function Parent6() {
    this.name = 'parent6';
    this.play = [1, 2, 3];
}
Parent6.prototype.getName = function () {
	return this.name;
}
function Child6() {
    Parent6.call(this);
    this.friends = 'child5';
}

clone(Parent6, Child6);

Child6.prototype.getFriends = function () {
	return this.friends;
}

let person6 = new Child6();
console.log(person6);
console.log(person6.getName());
console.log(person6.getFriends());
```


---
ES6 æä¾›äº†ç»§æ‰¿å…³é”®å­—extends

**ES6 çš„ extends å…³é”®å­—å®ç°é€»è¾‘**

```js
class Person {
  constructor(name) {
    this.name = name
  }
  // åŸå‹æ–¹æ³•
  // å³ Person.prototype.getName = function() { }
  // ä¸‹é¢å¯ä»¥ç®€å†™ä¸º getName() {...}
  getName = function () {
    console.log('Person:', this.name)
  }
}
class Gamer extends Person {
  constructor(name, age) {
    // å­ç±»ä¸­å­˜åœ¨æ„é€ å‡½æ•°ï¼Œåˆ™éœ€è¦åœ¨ä½¿ç”¨â€œthisâ€ä¹‹å‰é¦–å…ˆè°ƒç”¨ super()ã€‚
    super(name)
    this.age = age
  }
}
const asuna = new Gamer('Asuna', 20)
asuna.getName() // æˆåŠŸè®¿é—®åˆ°çˆ¶ç±»çš„æ–¹æ³•
```

```js
function _possibleConstructorReturn (self, call) { 
		// ...
		return call && (typeof call === 'object' || typeof call === 'function') ? call : self; 
}
function _inherits (subClass, superClass) { 
    // è¿™é‡Œå¯ä»¥çœ‹åˆ°
	subClass.prototype = Object.create(superClass && superClass.prototype, { 
		constructor: { 
			value: subClass, 
			enumerable: false, 
			writable: true, 
			configurable: true 
		} 
	}); 
	if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; 
}

var Parent = function Parent () {
	// éªŒè¯æ˜¯å¦æ˜¯ Parent æ„é€ å‡ºæ¥çš„ this
	_classCallCheck(this, Parent);
};
var Child = (function (_Parent) {
	_inherits(Child, _Parent);
	function Child () {
		_classCallCheck(this, Child);
		return _possibleConstructorReturn(this, (Child.__proto__ || Object.getPrototypeOf(Child)).apply(this, arguments));
}
	return Child;
}(Parent));
```

# newã€applyã€callã€bind
**- new**
[å‚è€ƒé“¾æ¥-1](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/new)
[å‚è€ƒé“¾æ¥-2](https://www.tutorialsteacher.com/javascript/new-keyword-in-javascript)
> new è¿ç®—ç¬¦åˆ›å»ºä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å¯¹è±¡ç±»å‹çš„å®ä¾‹æˆ–å…·æœ‰æ„é€ å‡½æ•°çš„å†…ç½®å¯¹è±¡çš„å®ä¾‹ã€‚

```javascript
function Car(make, model, year) {
  this.make = make;
  this.model = model;
  this.year = year;
}

const car1 = new Car('Eagle', 'Talon TSi', 1993);

console.log(car1.make);
// expected output: "Eagle"
```

```javascript
function Person(){
   this.name = 'Jack'; 
   return {age: 18}
}

var p = new Person(); 
console.log(p)  // {age: 18}
console.log(p.name) // undefined
console.log(p.age) // 18
```

```javascript
function Person(){
   this.name = 'Jack'; 
   return 'tom';
}
var p = new Person(); 
console.log(p)  // {name: 'Jack'}
console.log(p.name) // Jack
```

Attention
 new å…³é”®è¯æ‰§è¡Œä¹‹åæ€»æ˜¯ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¦ä¹ˆæ˜¯å®ä¾‹å¯¹è±¡ï¼Œè¦ä¹ˆæ˜¯ return è¯­å¥æŒ‡å®šçš„å¯¹è±¡ã€‚

**- apply & call & bind**
callã€apply å’Œ bind æ˜¯æŒ‚åœ¨ Function å¯¹è±¡ä¸Šçš„ä¸‰ä¸ªæ–¹æ³•ï¼Œè°ƒç”¨è¿™ä¸‰ä¸ªæ–¹æ³•çš„å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°

```javascript
func.call(thisArg, param1, param2, ...)
func.apply(thisArg, [param1,param2,...])
func.bind(thisArg, param1, param2, ...)
```
éƒ½å¯ä»¥æ”¹å˜å‡½æ•° func çš„ this æŒ‡å‘ã€‚
call å’Œ apply çš„åŒºåˆ«åœ¨äºï¼Œä¼ å‚çš„å†™æ³•ä¸åŒï¼šapply çš„ç¬¬ 2 ä¸ªå‚æ•°ä¸ºæ•°ç»„ï¼› call åˆ™æ˜¯ä»ç¬¬ 2 ä¸ªè‡³ç¬¬ N ä¸ªéƒ½æ˜¯ç»™ func çš„ä¼ å‚ï¼›è€Œ bind å’Œè¿™ä¸¤ä¸ªï¼ˆcallã€applyï¼‰åˆä¸åŒï¼Œbind è™½ç„¶æ”¹å˜äº† func çš„ this æŒ‡å‘ï¼Œä½†ä¸æ˜¯é©¬ä¸Šæ‰§è¡Œï¼Œè€Œè¿™ä¸¤ä¸ªï¼ˆcallã€applyï¼‰æ˜¯åœ¨æ”¹å˜äº†å‡½æ•°çš„ this æŒ‡å‘ä¹‹åç«‹é©¬æ‰§è¡Œ

```javascript
let a = {
  name: 'jack',
  getName: function(msg) {
    return msg + this.name;
  } 
}
let b = {
  name: 'lily'
}
console.log(a.getName('hello~'));  // hello~jack
console.log(a.getName.call(b, 'hi~'));  // hi~lily
console.log(a.getName.apply(b, ['hi~']))  // hi~lily
let name = a.getName.bind(b, 'hello~');
console.log(name());  // hello~lily
```

***æ–¹æ³•çš„åº”ç”¨åœºæ™¯***
- ç±»æ•°ç»„å€Ÿç”¨æ–¹æ³•

```javascript
var arrayLike = { 
  0: 'java',
  1: 'script',
  length: 2
} 
Array.prototype.push.call(arrayLike, 'jack', 'lily'); 
console.log(typeof arrayLike); // 'object'
console.log(arrayLike);
// {0: "java", 1: "script", 2: "jack", 3: "lily", length: 4}
```
arrayLike æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ¨¡æ‹Ÿæ•°ç»„çš„ä¸€ä¸ªç±»æ•°ç»„ã€‚ä»æ•°æ®ç±»å‹ä¸Šçœ‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œç”¨ typeof æ¥åˆ¤æ–­è¾“å‡ºçš„æ˜¯ 'object'ï¼Œå®ƒè‡ªèº«æ˜¯ä¸ä¼šæœ‰æ•°ç»„çš„ push æ–¹æ³•çš„ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ç”¨ call çš„æ–¹æ³•æ¥å€Ÿç”¨ Array åŸå‹é“¾ä¸Šçš„ push æ–¹æ³•ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªç±»æ•°ç»„çš„ push æ–¹æ³•ï¼Œç»™ arrayLike æ·»åŠ æ–°çš„å…ƒç´ ã€‚
- è·å–æ•°ç»„çš„æœ€å¤§ / æœ€å°å€¼
ç”¨ apply æ¥å®ç°æ•°ç»„ä¸­åˆ¤æ–­æœ€å¤§ / æœ€å°å€¼ï¼Œapply ç›´æ¥ä¼ é€’æ•°ç»„ä½œä¸ºè°ƒç”¨æ–¹æ³•çš„å‚æ•°

```javascript
let arr = [13, 6, 10, 11, 16];
const max = Math.max.apply(Math, arr); 
const min = Math.min.apply(Math, arr);
 
console.log(max);  // 16
console.log(min);  // 6
```
- ç»§æ‰¿

## å¦‚ä½•è‡ªå·±å®ç°è¿™äº›æ–¹æ³•
**new**

```javascript
function _new(ctor, ...args) {
    if(typeof ctor !== 'function') {
      throw 'ctor must be a function';
    }
    let obj = new Object();
    obj.__proto__ = Object.create(ctor.prototype);
    let res = ctor.apply(obj,  [...args]);

    let isObject = typeof res === 'object' && typeof res !== null;
    let isFunction = typeof res === 'function';
    return isObect || isFunction ? res : obj;
};
```
**apply å’Œ call**

```javascript
Function.prototype.call = function (context, ...args) {
  var context = context || window;
  context.fn = this;
  var result = eval('context.fn(...args)');
  delete context.fn
  return result;
}
Function.prototype.apply = function (context, args) {
  let context = context || window;
  context.fn = this;
  let result = eval('context.fn(...args)');
  delete context.fn
  return result;
}
```
**bind**

```javascript
Function.prototype.bind = function (context, ...args) {
    if (typeof this !== "function") {
      throw new Error("this must be a function");
    }
    var self = this;
    var fbound = function () {
        self.apply(this instanceof self ? this : context, args.concat(Array.prototype.slice.call(arguments)));
    }
    if(this.prototype) {
      fbound.prototype = Object.create(this.prototype);
    }
    return fbound;
}
```
| æ–¹æ³•/ç‰¹å¾ | call             | apply            | bind             |
| --------- | ---------------- | ---------------- | ---------------- |
| æ–¹æ³•å‚æ•°  | å¤šä¸ª             | å•ä¸ªæ•°ç»„         | å¤šä¸ª             |
| æ–¹æ³•åŠŸèƒ½  | å‡½æ•°è°ƒç”¨æ”¹å˜this | å‡½æ•°è°ƒç”¨æ”¹å˜this | å‡½æ•°è°ƒç”¨æ”¹å˜this |
| è¿”å›ç»“æœ  | ç›´æ¥æ‰§è¡Œ         | ç›´æ¥æ‰§è¡Œ         | è¿”å›å¾…æ‰§è¡Œå‚æ•°   |