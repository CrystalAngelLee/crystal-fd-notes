# æµ…æ‹·è´

> è‡ªå·±åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ¥æŽ¥å—è¦é‡æ–°èµ‹å€¼æˆ–å¼•ç”¨çš„å¯¹è±¡å€¼ã€‚å¦‚æžœå¯¹è±¡å±žæ€§æ˜¯åŸºæœ¬çš„æ•°æ®ç±»åž‹ï¼Œå¤åˆ¶çš„å°±æ˜¯åŸºæœ¬ç±»åž‹çš„å€¼ç»™æ–°å¯¹è±¡ï¼›ä½†å¦‚æžœå±žæ€§æ˜¯å¼•ç”¨æ•°æ®ç±»åž‹ï¼Œå¤åˆ¶çš„å°±æ˜¯å†…å­˜ä¸­çš„åœ°å€ï¼Œå¦‚æžœå…¶ä¸­ä¸€ä¸ªå¯¹è±¡æ”¹å˜äº†è¿™ä¸ªå†…å­˜ä¸­çš„åœ°å€ï¼Œè‚¯å®šä¼šå½±å“åˆ°å¦ä¸€ä¸ªå¯¹è±¡

## æ–¹æ¡ˆä¸€ï¼š[object.assign](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)

```js
const target = { a: 1, b: 2 };
const source = { b: 4, c: 5 };

const returnedTarget = Object.assign(target, source);

console.log(target);
// expected output: Object { a: 1, b: 4, c: 5 }

console.log(returnedTarget);
// expected output: Object { a: 1, b: 4, c: 5 }
```

ðŸ“¢**Attention**:

object.assignä¸ä¼šæ‹·è´å¯¹è±¡çš„ç»§æ‰¿å±žæ€§ï¼›

object.assignä¸ä¼šæ‹·è´å¯¹è±¡çš„ä¸å¯æžšä¸¾çš„å±žæ€§ï¼›

å¯ä»¥æ‹·è´ Symbol ç±»åž‹çš„å±žæ€§ã€‚



## æ–¹æ¡ˆäºŒï¼š[æ‰©å±•è¿ç®—ç¬¦ { ...obj }](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Spread_syntax)

```js
var arr = [1, 2, 3];
var arr2 = [...arr]; // like arr.slice()
arr2.push(4);

// arr2 æ­¤æ—¶å˜æˆ [1, 2, 3, 4]
// arr ä¸å—å½±å“
```



## æ–¹æ¡ˆä¸‰ï¼š[concat æ‹·è´æ•°ç»„](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/concat)

```js
let arr = [1, 2, 3];
let newArr = arr.concat();
newArr[1] = 100;
console.log(arr);  // [ 1, 2, 3 ]
console.log(newArr); // [ 1, 100, 3 ]
```



## æ–¹æ¡ˆå››ï¼š[slice æ‹·è´æ•°ç»„](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/slice)

```js
let arr = [1, 2, {val: 4}];
let newArr = arr.slice();
newArr[2].val = 1000;
console.log(arr);  //[ 1, 2, { val: 1000 } ]
```



# æ·±æ‹·è´

> å°†ä¸€ä¸ªå¯¹è±¡ä»Žå†…å­˜ä¸­å®Œæ•´åœ°æ‹·è´å‡ºæ¥ä¸€ä»½ç»™ç›®æ ‡å¯¹è±¡ï¼Œå¹¶ä»Žå †å†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªå…¨æ–°çš„ç©ºé—´å­˜æ”¾æ–°å¯¹è±¡ï¼Œä¸”æ–°å¯¹è±¡çš„ä¿®æ”¹å¹¶ä¸ä¼šæ”¹å˜åŽŸå¯¹è±¡ï¼ŒäºŒè€…å®žçŽ°çœŸæ­£çš„åˆ†ç¦»ã€‚

## æ–¹æ¡ˆä¸€ï¼š JSON.stringfy - JSON.parse()

```js
let obj1 = { a:1, b:[1,2,3] }
let str = JSON.stringify(obj1)ï¼›
let obj2 = JSON.parse(str)ï¼›
console.log(obj2);   //{a:1,b:[1,2,3]} 
obj1.a = 2ï¼›
obj1.b.push(4);
console.log(obj1);   //{a:2,b:[1,2,3,4]}
console.log(obj2);   //{a:1,b:[1,2,3]}
```

```js
function Obj() { 
  this.func = function () { alert(1) }; 
  this.obj = {a:1};
  this.arr = [1,2,3];
  this.und = undefined; 
  this.reg = /123/; 
  this.date = new Date(0); 
  this.NaN = NaN;
  this.infinity = Infinity;
  this.sym = Symbol(1);
} 
let obj1 = new Obj();
Object.defineProperty(obj1,'innumerable',{ 
  enumerable:false,
  value:'innumerable'
});
console.log('obj1',obj1);
let str = JSON.stringify(obj1);
let obj2 = JSON.parse(str);
console.log('obj2',obj2);
```

ðŸ“¢**Attention:**

1. æ‹·è´çš„å¯¹è±¡çš„å€¼ä¸­å¦‚æžœæœ‰å‡½æ•°ã€undefinedã€symbol è¿™å‡ ç§ç±»åž‹ï¼Œç»è¿‡ JSON.stringify åºåˆ—åŒ–ä¹‹åŽçš„å­—ç¬¦ä¸²ä¸­è¿™ä¸ªé”®å€¼å¯¹ä¼šæ¶ˆå¤±ï¼›
2. æ‹·è´ Date å¼•ç”¨ç±»åž‹ä¼šå˜æˆå­—ç¬¦ä¸²ï¼›
3. æ— æ³•æ‹·è´ä¸å¯æžšä¸¾çš„å±žæ€§ï¼›
4. æ— æ³•æ‹·è´å¯¹è±¡çš„åŽŸåž‹é“¾ï¼›
5. æ‹·è´ RegExp å¼•ç”¨ç±»åž‹ä¼šå˜æˆç©ºå¯¹è±¡ï¼›
6. å¯¹è±¡ä¸­å«æœ‰ NaNã€Infinity ä»¥åŠ -Infinityï¼ŒJSON åºåˆ—åŒ–çš„ç»“æžœä¼šå˜æˆ nullï¼›
7. æ— æ³•æ‹·è´å¯¹è±¡çš„å¾ªçŽ¯åº”ç”¨ï¼Œå³å¯¹è±¡æˆçŽ¯ (obj[key] = obj)ã€‚



## æ–¹æ¡ˆäºŒï¼š é€’å½’

```js
let obj1 = {
  a:{
    b:1
  }
}
function deepClone(obj) { 
  let cloneObj = {}
  for(let key in obj) {                 //éåŽ†
    if(typeof obj[key] ==='object') { 
      cloneObj[key] = deepClone(obj[key])  //æ˜¯å¯¹è±¡å°±å†æ¬¡è°ƒç”¨è¯¥å‡½æ•°é€’å½’
    } else {
      cloneObj[key] = obj[key]  //åŸºæœ¬ç±»åž‹çš„è¯ç›´æŽ¥å¤åˆ¶å€¼
    }
  }
  return cloneObj
}
let obj2 = deepClone(obj1);
obj1.a.b = 2;
console.log(obj2);   //  {a:{b:1}}
```

ðŸ“¢**Attention:**

1. è¿™ä¸ªæ·±æ‹·è´å‡½æ•°å¹¶ä¸èƒ½å¤åˆ¶ä¸å¯æžšä¸¾çš„å±žæ€§ä»¥åŠ Symbol ç±»åž‹ï¼›
2. è¿™ç§æ–¹æ³•åªæ˜¯é’ˆå¯¹æ™®é€šçš„å¼•ç”¨ç±»åž‹çš„å€¼åšé€’å½’å¤åˆ¶ï¼Œè€Œå¯¹äºŽ Arrayã€Dateã€RegExpã€Errorã€Function è¿™æ ·çš„å¼•ç”¨ç±»åž‹å¹¶ä¸èƒ½æ­£ç¡®åœ°æ‹·è´ï¼›
3. å¯¹è±¡çš„å±žæ€§é‡Œé¢æˆçŽ¯ï¼Œå³å¾ªçŽ¯å¼•ç”¨æ²¡æœ‰è§£å†³ã€‚



## æ–¹æ¡ˆä¸‰ï¼š å¢žå¼ºç‰ˆé€’å½’

>1. é’ˆå¯¹èƒ½å¤ŸéåŽ†å¯¹è±¡çš„ä¸å¯æžšä¸¾å±žæ€§ä»¥åŠ Symbol ç±»åž‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Reflect.ownKeys æ–¹æ³•ï¼›
>2. å½“å‚æ•°ä¸º Dateã€RegExp ç±»åž‹ï¼Œåˆ™ç›´æŽ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„å®žä¾‹è¿”å›žï¼›
>3. åˆ©ç”¨ Object çš„ getOwnPropertyDescriptors æ–¹æ³•å¯ä»¥èŽ·å¾—å¯¹è±¡çš„æ‰€æœ‰å±žæ€§ï¼Œä»¥åŠå¯¹åº”çš„ç‰¹æ€§ï¼Œé¡ºä¾¿ç»“åˆ Object çš„ create æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¹¶ç»§æ‰¿ä¼ å…¥åŽŸå¯¹è±¡çš„åŽŸåž‹é“¾ï¼›
>4. åˆ©ç”¨ [WeakMap](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/WeakMap)  ç±»åž‹ä½œä¸º Hash è¡¨ï¼Œå› ä¸º WeakMap æ˜¯å¼±å¼•ç”¨ç±»åž‹ï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢å†…å­˜æ³„æ¼ï¼ˆä½ å¯ä»¥å…³æ³¨ä¸€ä¸‹ Map å’Œ weakMap çš„å…³é”®åŒºåˆ«ï¼Œè¿™é‡Œè¦ç”¨ weakMapï¼‰ï¼Œä½œä¸ºæ£€æµ‹å¾ªçŽ¯å¼•ç”¨å¾ˆæœ‰å¸®åŠ©ï¼Œå¦‚æžœå­˜åœ¨å¾ªçŽ¯ï¼Œåˆ™å¼•ç”¨ç›´æŽ¥è¿”å›ž WeakMap å­˜å‚¨çš„å€¼ã€‚

```js
const isComplexDataType = obj => (typeof obj === "object" || typeof obj === "function") && obj !== null;

const deepClone = function (obj, hash = new WeakMap()) {
  if (obj.constructor === Date) return new Date(obj); // æ—¥æœŸå¯¹è±¡ç›´æŽ¥è¿”å›žä¸€ä¸ªæ–°çš„æ—¥æœŸå¯¹è±¡
  if (obj.constructor === RegExp) return new RegExp(obj); //æ­£åˆ™å¯¹è±¡ç›´æŽ¥è¿”å›žä¸€ä¸ªæ–°çš„æ­£åˆ™å¯¹è±¡

  //å¦‚æžœå¾ªçŽ¯å¼•ç”¨äº†å°±ç”¨ weakMap æ¥è§£å†³
  if (hash.has(obj)) return hash.get(obj);
  let allDesc = Object.getOwnPropertyDescriptors(obj);

  //éåŽ†ä¼ å…¥å‚æ•°æ‰€æœ‰é”®çš„ç‰¹æ€§
  let cloneObj = Object.create(Object.getPrototypeOf(obj), allDesc);

  //ç»§æ‰¿åŽŸåž‹é“¾
  hash.set(obj, cloneObj);

  for (let key of Reflect.ownKeys(obj)) {
    cloneObj[key] = isComplexDataType(obj[key]) && typeof obj[key] !== "function" ? deepClone(obj[key], hash) : obj[key];
  }

  return cloneObj;
};

// ä¸‹é¢æ˜¯éªŒè¯ä»£ç 
let obj = {
  num: 0,
  str: "",
  boolean: true,
  unf: undefined,
  nul: null,
  obj: { name: "æˆ‘æ˜¯ä¸€ä¸ªå¯¹è±¡", id: 1 },
  arr: [0, 1, 2],
  func: function () {
    console.log("æˆ‘æ˜¯ä¸€ä¸ªå‡½æ•°");
  },
  date: new Date(0),
  reg: new RegExp("/æˆ‘æ˜¯ä¸€ä¸ªæ­£åˆ™/ig"),
  [Symbol("1")]: 1,
};

Object.defineProperty(obj, "innumerable", {
  enumerable: false,
  value: "ä¸å¯æžšä¸¾å±žæ€§",
});

obj = Object.create(obj, Object.getOwnPropertyDescriptors(obj));
obj.loop = obj; // è®¾ç½®loopæˆå¾ªçŽ¯å¼•ç”¨çš„å±žæ€§
let cloneObj = deepClone(obj);
cloneObj.arr.push(4);
console.log("obj", obj);
console.log("cloneObj", cloneObj);
```



# å°è¯•ä¸€å¤

```js
/* å¯¹è±¡çš„æ‹·è´ */
let obj = {a:1,b:{c:1}}
let obj2 = {...obj}
obj.a = 2
console.log(obj)  //{a:2,b:{c:1}} console.log(obj2); //{a:1,b:{c:1}}
obj.b.c = 2
console.log(obj)  //{a:2,b:{c:2}} console.log(obj2); //{a:1,b:{c:2}}
/* æ•°ç»„çš„æ‹·è´ */
let arr = [1, 2, 3];
let newArr = [...arr]; //è·Ÿarr.slice()æ˜¯ä¸€æ ·çš„æ•ˆæžœ
```



```js
// è¯·è‡ªè¡Œå®žçŽ°ä¸€ä¸ªæµ…æ‹·è´  1. å¯¹åŸºç¡€ç±»åž‹åšä¸€ä¸ªæœ€åŸºæœ¬çš„ä¸€ä¸ªæ‹·è´ 2. å¯¹å¼•ç”¨ç±»åž‹å¼€è¾Ÿä¸€ä¸ªæ–°çš„å­˜å‚¨ï¼Œå¹¶ä¸”æ‹·è´ä¸€å±‚å¯¹è±¡å±žæ€§
const shallowClone = (target) => {
  if (typeof target === 'object' && target !== null) {
    const cloneTarget = Array.isArray(target) ? [] : {};
    for (let prop in target) {
      if (target.hasOwnProperty(prop)) {
        cloneTarget[prop] = target[prop];
      }
    }
    return cloneTarget;
  }
  return target;
}
```