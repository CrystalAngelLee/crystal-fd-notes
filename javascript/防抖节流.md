# 概述

**为什么需要防抖和节流**

 在一些高频率事件触发的场景下，我们不希望对应的时间处理函数多次执行

**常见应用场景**

- 滚动事件
- 模糊匹配
- 轮播图切换
- 点击操作
- ...

浏览器默认情况下都会有自己的监听事件间隔（4-6ms），如果检测到多次事件的监听执行，那么就会造成不必要的资源浪费



## 概念

**防抖**

当持续触发事件时，一定时间段内没有再触发事件，事件处理函数才会执行一次，如果设定的时间到来之前，又一次触发了事件，就重新开始延时

用途： 1.用于可能出现高频触发修改，导致页面高频重排重绘，严重影响性能，同时也导致操作的DOM闪烁抖动，体验效果差

**节流**

用来实现阻止在短时间内重复多次触发同一个函数。

主要用途：防止使用脚本循环触发网络请求的函数的恶意行为，确保请求的真实性（当然也包括其他阻止高频触发行为的应用）



# 实现

## 防抖（debounce）

```js
/**
 * handler 最终需要执行的事件监听
 * time 事件触发之后多久开始执行
 * immediate 控制执行第一次还是最后一次， false 执行最后一次
*/
function debounce (handler, time, immediate) {
  // 参数类型判断及默认值处理
  if (typeof handler !== "function") throw new Error("handler must be an function")
  if (typeof time === 'undefined') time = 300
  if (typeof time === 'boolean') {
    immediate = time
    time = 300
  }
  if (typeof immediate !== 'boolean') immediate = false
  
  var timer = null
  return function() {
    var _this = this, init = immediate && !timer;
    var args = arguments;
    timer !== null && clearTimeout(timer);
    timer = setTimeout(function () {
      timer = null
      !immediate ? handler.apply(_this, args) : null
    }, time)
    
    // 如果当前传递进来的是 true 就表示需要立即执行
    // timer 为 null 就意味着没有第二次...
    init ? handler.apply(_this, args) : null
  }
}
```



## 节流（throttle）

> 在自定义的一段时间内让事件进行触发

```js
function throttle (handler, time) {
  // 参数类型判断及默认值处理
  if (typeof handler !== "function") throw new Error("handler must be an function")
  if (typeof time === 'undefined') time = 300
  var lastDate = 0; // 定义变量记录上一次执行的时间
  var timer = null;
  return function() {
    var date = new Date() // 定义变量记录当前次执行的时刻时间
    if (time- (date - lastDate) <= 0 ) {
      clearTimeout(timer)
      timer = null
      handler.apply(this, arguments);
      lastDate = new Date();
    } else if (!timer) {
      var _this = this;
      var args = arguments
      timer = setTimeout(function() {
        clearTimeout(timer) // 知识将系统中的定时器清除了，但是 timer 中的值还在
        timer = null
        handler.apply(_this, args)
        lastDate = new Date();
      },time)
    }
  }
}
```

